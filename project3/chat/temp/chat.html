<div class="row my-5 justify-content-center">
    <div class="col-12 col-md-10 col-lg-8">
        <div class="card">
            <div class="card-header">
                <h4>{{title}}[{{room}}]</h4>
            </div>
            <div class="card-body">
                <div id="contents"></div>
                <form name="frm" class="input-group my-3">
                    <input name="text" class="form-control">
                    <button class="btn btn-outline-warning px-3">전송</button>
                </form>
            </div>
        </div>
        <div class="text-end my-3">
                <button id="left" class="btn btn-outline-warning">퇴장하기</button>
            </div>
    </div>
</div>
<script>
    //1)웹소켓 생성
    const socket = io.connect(`http://${document.domain}:${location.port}/chat`)

    //2)웹소켓 접속
    socket.on("connect", function(){
        socket.emit("joined");
    });

    //3)웹서버에서 status 요청이 온 경우
    socket.on('status', function(data){
        $("#contents").append(`<div>${data.msg}</div>`);
    })

    //4)메시지를 웹서버에 전송
    $(frm).on("submit", function(e){
        e.preventDefault();
        const text=$(frm.text).val()
        if(text==""){
            alert("전송할 내용을 입력하세요.");
        }else{
            socket.emit("text", {msg:text});
            $(frm.text).val("");
        }
    })

    //5)웹서버에서 보낸 메시지 출력
    socket.on("message", function(data){
        $("#contents").append(`<div>${data.msg}</div>`);
    })

    //6)퇴장할 때
    $("#left").on("click", function(){
        socket.emit("left")
        window.location.href= '/';
    });
</script>